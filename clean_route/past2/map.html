<!doctype html>
<html lang="en">
  <head>
    <link rel="stylesheet" href="https://openlayers.org/en/v4.5.0/css/ol.css" type="text/css">
    <style>
      .map {
        height: 800px;
        width: 100%;
      }
    </style>
    <script src="https://openlayers.org/en/v4.5.0/build/ol.js" type="text/javascript"></script>
    <title>OpenLayers example</title>
  </head>
  <body>
    <div id="map" class="map"></div>
    <script type="text/javascript">
      // This long string is placed here due to jsFiddle limitations.
      // It is usually loaded with AJAX.
      var array = [[24.1788025, 120.6466394], [24.1807328, 120.6465984], [24.1807391, 120.6474008], [24.1807521, 120.6479984], [24.1807547, 120.6482481], [24.1807555, 120.6482906], [24.1812951, 120.6482631], [24.1813868, 120.6482155], [24.1816721, 120.6482093], [24.1819409, 120.6482531], [24.1819141, 120.6469845], [24.1819248, 120.6462897], [24.1828806, 120.646247], [24.1834353, 120.6462548], [24.1843179, 120.6462275], [24.1844651, 120.6462325], [24.1844549, 120.6455154], [24.184457, 120.6446055], [24.1844215, 120.6424168], [24.185087, 120.6424222], [24.1851727, 120.6424168], [24.1851739, 120.6419327], [24.1851637, 120.6413908], [24.1865533, 120.6413588], [24.1872713, 120.6413562], [24.1872875, 120.6404571], [24.1872954, 120.6395269], [24.1865684, 120.6391958], [24.1865544, 120.6387097], [24.1865462, 120.6386728], [24.1865221, 120.6386418], [24.1855687, 120.6381421], [24.1856988, 120.6376686], [24.1857241, 120.6375744], [24.1858015, 120.6373512], [24.1858304, 120.6373027], [24.1859113, 120.6371592], [24.1859244, 120.6370567], [24.1862106, 120.6365324], [24.1863481, 120.6361981], [24.1863862, 120.6361054], [24.1864485, 120.6359564], [24.1866332, 120.6355029], [24.1867055, 120.635391], [24.187329, 120.6355129], [24.1876146, 120.6355102], [24.1878389, 120.6354932], [24.1881162, 120.6354553], [24.188477, 120.6354769], [24.1887274, 120.6353744], [24.1890222, 120.6351398], [24.1892625, 120.6348948], [24.1894211, 120.6348354], [24.1896176, 120.6347976], [24.1898359, 120.6346382], [24.190102, 120.6345344], [24.190222, 120.6344877], [24.1904087, 120.6344929], [24.1910503, 120.6346729], [24.1913944, 120.6347697], [24.1915829, 120.6348165], [24.1916427, 120.6348314], [24.192175, 120.6348842], [24.1923244, 120.6348735], [24.1930258, 120.634823], [24.1936863, 120.6347621], [24.1941033, 120.6346609], [24.1941839, 120.6344898], [24.1947416, 120.6342809], [24.1950651, 120.6342832], [24.1957669, 120.6342829], [24.1962279, 120.6342874], [24.1965973, 120.6343931], [24.1969516, 120.6344639], [24.1971262, 120.6344657], [24.197465, 120.6345113], [24.1976632, 120.6345771], [24.1978332, 120.6346656], [24.1980602, 120.6347808], [24.1981024, 120.6347836], [24.1981135, 120.6347791], [24.1981494, 120.6347649], [24.1983103, 120.6347275], [24.1986512, 120.6345612], [24.1987341, 120.6345191], [24.1991581, 120.6343095], [24.1995165, 120.6341217], [24.1998076, 120.6339635], [24.1998798, 120.6338964], [24.2000107, 120.6335169], [24.2002529, 120.6325902], [24.2003717, 120.6321862], [24.2005085, 120.6317212], [24.2007618, 120.6309688], [24.2009978, 120.6302111], [24.201081, 120.6300005], [24.2011639, 120.6298329], [24.2012544, 120.6290819], [24.2015517, 120.627954], [24.2016244, 120.627665], [24.2016624, 120.6275255], [24.2016501, 120.6274732], [24.2015058, 120.627264], [24.2016357, 120.6271198], [24.2017504, 120.6270025], [24.2019926, 120.6263373], [24.202033, 120.6261884], [24.2020232, 120.6260825], [24.2020367, 120.6259564], [24.2023192, 120.6251933], [24.2026299, 120.6243176], [24.2026776, 120.6241204], [24.2028085, 120.6238106], [24.20297, 120.6231763], [24.2031302, 120.6228397], [24.2033015, 120.6226667], [24.2033614, 120.6227565], [24.2036134, 120.6232112], [24.2037259, 120.6233225], [24.2038201, 120.6234204], [24.2039473, 120.6234874], [24.2041149, 120.6235411], [24.2047106, 120.6237221], [24.2048721, 120.6237704], [24.205003, 120.6238482], [24.2057699, 120.6244007], [24.2060574, 120.6245483], [24.2062213, 120.6246166], [24.2064206, 120.624677], [24.2064542, 120.6246837], [24.206576, 120.6247078], [24.2066738, 120.6247239], [24.2068194, 120.6247548], [24.2069241, 120.6247863], [24.2072127, 120.6234713], [24.2074867, 120.6225838], [24.2079234, 120.6227138], [24.2093541, 120.6231797], [24.2098331, 120.6233597], [24.2105002, 120.6220829], [24.2106876, 120.6217537], [24.2107558, 120.6215787], [24.2116196, 120.6219528], [24.2118617, 120.6222291], [24.2122067, 120.6223686], [24.2123339, 120.6224893], [24.2128256, 120.6226127], [24.213058, 120.6228004], [24.2131852, 120.6231625], [24.2134053, 120.6234656], [24.2136206, 120.6235756], [24.2136977, 120.6235595], [24.2139814, 120.6232524], [24.2144902, 120.6223324], [24.214616, 120.6223446], [24.2148156, 120.6224102], [24.2149155, 120.6224487], [24.2148821, 120.6225314], [24.2148792, 120.6225765], [24.2148919, 120.6226356], [24.2149194, 120.6226754], [24.2149302, 120.6226302], [24.2149223, 120.6225862], [24.2150134, 120.6223832], [24.2151108, 120.6222228], [24.2152013, 120.6220592], [24.21566, 120.62117], [24.2158188, 120.6208623], [24.2163348, 120.6198621], [24.2172565, 120.620425], [24.2173433, 120.6203771], [24.2177807, 120.6194995], [24.2178426, 120.6184807], [24.2178919, 120.6184223], [24.2180022, 120.6182065], [24.2182243, 120.6178784], [24.2186104, 120.617185], [24.2186417, 120.6170791], [24.2186172, 120.6170261], [24.2183058, 120.6166787], [24.2182627, 120.6166016], [24.2182728, 120.6163988], [24.2182744, 120.6161881], [24.218484, 120.6162138], [24.2187836, 120.6161146], [24.2191016, 120.6159711], [24.2192924, 120.6158758], [24.21963, 120.6159456], [24.2197269, 120.616006], [24.2198085, 120.6160569], [24.2199736, 120.6161387], [24.2201388, 120.6162594], [24.2202885, 120.6162518], [24.2203099, 120.6161231], [24.2203314, 120.6159943], [24.2203099, 120.6158656], [24.2202885, 120.6157368], [24.2202239, 120.6155121], [24.2202123, 120.6154718], [24.2201762, 120.6153331], [24.2203504, 120.6152567], [24.2204976, 120.6151628], [24.221828, 120.6143689], [24.222064, 120.6142616], [24.2222786, 120.6141973], [24.2224308, 120.6141637], [24.2240373, 120.6139341], [24.2253342, 120.6137708], [24.2272782, 120.613473], [24.2280624, 120.6133711], [24.2285584, 120.6133578], [24.2290997, 120.6133792], [24.2297317, 120.6134516], [24.2310572, 120.6135938], [24.2316088, 120.6136504], [24.2325766, 120.6137707], [24.2330328, 120.6138196], [24.2339284, 120.6139331], [24.2343739, 120.6139397], [24.2355824, 120.6141127], [24.2359802, 120.6141758], [24.2364456, 120.6142187], [24.2366405, 120.6142026], [24.2369415, 120.6140846], [24.2372746, 120.6139394], [24.2374605, 120.6139046], [24.2376696, 120.6139019], [24.2378811, 120.6139595], [24.2395363, 120.6144363], [24.2401489, 120.6145972], [24.2404962, 120.6146697], [24.2419331, 120.61484], [24.2419649, 120.6147461], [24.2419918, 120.6146576], [24.2421359, 120.614231], [24.2421947, 120.6140012], [24.2423317, 120.6134506], [24.242366, 120.6133245], [24.2424834, 120.6127693], [24.2425494, 120.6124367], [24.2426643, 120.6117393], [24.2427842, 120.6112807], [24.2428527, 120.6108408], [24.2429554, 120.61013], [24.2430777, 120.6096767], [24.2430972, 120.6095668], [24.2432253, 120.6091688], [24.2434454, 120.6087831], [24.2436305, 120.6084785], [24.243722, 120.6082577], [24.2437953, 120.6078521], [24.2438452, 120.6076208], [24.2439174, 120.6072863], [24.2439125, 120.6072482], [24.2439124, 120.6071454], [24.24396, 120.6069566], [24.2440772, 120.6066153], [24.2443336, 120.6059016], [24.2445678, 120.6051723], [24.2457793, 120.6056746], [24.2466916, 120.6028271], [24.2484908, 120.6035125], [24.2485962, 120.6035728], [24.2490483, 120.6025565], [24.2496242, 120.6013227], [24.2498822, 120.6007447], [24.2500131, 120.6003383], [24.2500852, 120.6000567], [24.2501317, 120.5997348], [24.2501549, 120.5992896], [24.2501662, 120.5983897], [24.25021, 120.5981842], [24.2502406, 120.5980949], [24.250283, 120.5980224], [24.2503422, 120.5979424], [24.2504324, 120.5978471], [24.2505855, 120.5977375], [24.2506699, 120.5977068], [24.2507259, 120.5976932], [24.2508504, 120.5976928], [24.2509307, 120.5977092], [24.2510502, 120.5977424], [24.2511577, 120.5977598], [24.2517968, 120.5980775], [24.2529298, 120.5986274], [24.2529825, 120.5987302], [24.2530032, 120.5987701], [24.2532264, 120.5988809], [24.2532756, 120.5989173], [24.2532889, 120.5989508], [24.2532729, 120.5989931], [24.2532398, 120.5990509], [24.2531979, 120.5990559], [24.2531455, 120.5990269], [24.2530946, 120.5989958], [24.2530449, 120.5989094], [24.2529586, 120.5987753], [24.2529506, 120.5987272], [24.2529298, 120.5986274], [24.2528842, 120.5986937]]
    var routeData = array.map(function(x) {
        return ol.proj.fromLonLat([x[1], x[0]]);
        })
    var route = new ol.geom.LineString(routeData);
    

    var routeCoords = route.getCoordinates();
    var routeLength = routeCoords.length;

    var routeFeature = new ol.Feature({
      type: 'route',
      geometry: route
    });
    var geoMarker = new ol.Feature({
      type: 'geoMarker',
      geometry: new ol.geom.Point(routeCoords[0])
    });
    var startMarker = new ol.Feature({
      type: 'icon',
      geometry: new ol.geom.Point(routeCoords[0])
    });
    var endMarker = new ol.Feature({
      type: 'icon',
      geometry: new ol.geom.Point(routeCoords[routeLength - 1])
    });

    var styles = {
      'route': new ol.style.Style({
        stroke: new ol.style.Stroke({
          width: 6, color: [237, 212, 0, 0.8]
        })
      }),
      'icon': new ol.style.Style({
        image: new ol.style.Icon({
          anchor: [0.5, 1],
          src: 'https://openlayers.org/en/v4.5.0/examples/data/icon.png'
        })
      }),
      'geoMarker': new ol.style.Style({
        image: new ol.style.Circle({
          radius: 7,
          snapToPixel: false,
          fill: new ol.style.Fill({color: 'black'}),
          stroke: new ol.style.Stroke({
            color: 'white', width: 2
          })
        })
      })
    };

    var animating = false;
    var speed, now;
    var speedInput = document.getElementById('speed');
    var startButton = document.getElementById('start-animation');

    var vectorLayer = new ol.layer.Vector({
      source: new ol.source.Vector({
        features: [routeFeature, geoMarker, startMarker, endMarker]
      }),
      style: function(feature) {
        // hide geoMarker if animation is active
        if (animating && feature.get('type') === 'geoMarker') {
          return null;
        }
        return styles[feature.get('type')];
      }
    });

    var center = ol.proj.fromLonLat([120, 25]);
    var map = new ol.Map({
      target: document.getElementById('map'),
      loadTilesWhileAnimating: true,
      view: new ol.View({
        center: center,
        zoom: 10,
        minZoom: 2,
        maxZoom: 19
      }),
      layers: [
      new ol.layer.Tile({
        source: new ol.source.OSM()
      }),
        vectorLayer
      ]
    });

    var moveFeature = function(event) {
      var vectorContext = event.vectorContext;
      var frameState = event.frameState;

      if (animating) {
        var elapsedTime = frameState.time - now;
        // here the trick to increase speed is to jump some indexes
        // on lineString coordinates
        var index = Math.round(speed * elapsedTime / 1000);

        if (index >= routeLength) {
          stopAnimation(true);
          return;
        }

        var currentPoint = new ol.geom.Point(routeCoords[index]);
        var feature = new ol.Feature(currentPoint);
        vectorContext.drawFeature(feature, styles.geoMarker);
      }
      // tell OpenLayers to continue the postcompose animation
      map.render();
    };

    function startAnimation() {
      if (animating) {
        stopAnimation(false);
      } else {
        animating = true;
        now = new Date().getTime();
        speed = speedInput.value;
        startButton.textContent = 'Cancel Animation';
        // hide geoMarker
        geoMarker.setStyle(null);
        // just in case you pan somewhere else
        map.getView().setCenter(center);
        map.on('postcompose', moveFeature);
        map.render();
      }
    }


    /**
     * @param {boolean} ended end of animation.
     */
    function stopAnimation(ended) {
      animating = false;
      startButton.textContent = 'Start Animation';

      // if animation cancelled set the marker at the beginning
      var coord = ended ? routeCoords[routeLength - 1] : routeCoords[0];
      /** @type {ol.geom.Point} */ (geoMarker.getGeometry())
          .setCoordinates(coord);
      //remove listener
      map.un('postcompose', moveFeature);
    }

    startButton.addEventListener('click', startAnimation, false);
    </script>
  </body>
</html>